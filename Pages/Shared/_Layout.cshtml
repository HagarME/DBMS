@using Microsoft.AspNetCore.Mvc.TagHelpers
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@{
    string IsActive(string pageName)
    {
        var current = ViewContext.RouteData.Values["page"]?.ToString() ?? "";
        if (pageName == "/Settings" && current.StartsWith("/Settings")) return "active";
        return current == pageName ? "active" : "";
    }

    var userRole = HttpContextAccessor.HttpContext?.Session.GetString("UserRole")?.ToLower() ?? "guest";
    var userName = HttpContextAccessor.HttpContext?.Session.GetString("UserName") ?? "User";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - DASH</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>

    <nav class="sidebar">
        <div class="brand">
            <span>DASH</span>
        </div>

        <div class="menu-list">
            @* Dashboard: Visible to Admin and Manager, Hidden for Employee *@
            @if (userRole != "employee")
            {
                <a asp-page="/Dashboard" class="menu-item @IsActive("/Dashboard")">
                    <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
                </a>
            }

            @* Employees: Visible to Everyone *@
            @if (userRole != "employee")
            {
                <a asp-page="/Employees" class="menu-item @IsActive("/Employees")">
                    <i class="fas fa-user-tie"></i> <span>Employees</span>
                </a>
            }

            @* Pending Accounts: Visible to Admin Only *@
            @if (userRole == "admin")
            {
                <a asp-page="/PendingAccounts" class="menu-item @IsActive("/PendingAccounts")">
                    <i class="fas fa-user-clock"></i> <span>Pending Accounts</span>
                </a>
            }

            @* Clients: Visible to Everyone *@
            @if (userRole != "employee")
            {
                <a asp-page="/Clients" class="menu-item @IsActive("/Clients")">
                    <i class="fas fa-users"></i> <span>Clients</span>
                </a>
            }

            @* Departments: Visible to Admin Only *@
            @if (userRole == "admin")
            {
                <a asp-page="/Departments" class="menu-item @IsActive("/Departments")">
                    <i class="fas fa-building"></i> <span>Departments</span>
                </a>
            }

            @* Tasks: Visible to Everyone *@
            <a asp-page="/Tasks" class="menu-item @IsActive("/Tasks")">
                <i class="fas fa-tasks"></i> <span>Tasks</span>
            </a>

            @* Emails & Requests: Visible to Everyone *@
            <a asp-page="/Email" class="menu-item @IsActive("/Email")">
                <i class="fas fa-envelope-open-text"></i> <span>Emails & Requests</span>
            </a>

            @* Documents: Visible to Everyone *@
            <a asp-page="/Documents" class="menu-item @IsActive("/Documents")">
                <i class="fas fa-file-alt"></i> <span>Documents</span>
            </a>

            @* Issue a Request: Visible to Everyone *@
            <a asp-page="/OfficeRequests" class="menu-item @IsActive("/OfficeRequests")">
                <i class="fas fa-paper-plane"></i> <span>Issue a Request</span>
            </a>

            @* Reports: Visible to Everyone *@
            <a asp-page="/Reports" class="menu-item @IsActive("/Reports")">
                <i class="fas fa-chart-bar"></i> <span>Reports</span>
            </a>

            <hr style="border-color:#444; margin: 10px 0;">

            <a asp-page="/Settings/Index" class="menu-item @IsActive("/Settings")">
                <i class="fas fa-cog"></i> <span>Settings</span>
            </a>

            <a asp-page="/Login" class="menu-item">
                <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
            </a>
        </div>
    </nav>

    <div class="main-wrapper">
        <header class="top-navbar">
            <div class="page-title">@ViewData["Title"]</div>
            <div class="user-actions">
                <i class="fas fa-bell"></i>
                <i class="fas fa-user-circle"></i>
            </div>
        </header>

        <main class="content-container">
            @RenderBody()
        </main>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="~/lib/chartjs/chart.umd.js"></script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>